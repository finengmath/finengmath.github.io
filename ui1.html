<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <title>Matematiikan suomi–englanti-sanasto</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 900px;
        }
        h1, h2 {
            margin-bottom: 5px;
        }
        input[type="text"] {
            padding: 8px;
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
            font-size: 16px;
        }
        .term {
            margin-bottom: 15px;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        .term strong {
            font-size: 18px;
        }
        .label {
            font-weight: bold;
        }
        .concept-id {
            font-style: italic;
            color: #555;
        }
        #status {
            margin-bottom: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>Matematiikan suomi–englanti-sanasto</h1>

<div id="status">Ladataan sanastoa...</div>
<input type="text" id="search" placeholder="Hakusana (suomeksi tai englanniksi)..." disabled>

<div id="results"></div>

<script>
let terms = [];
const searchInput = document.getElementById('search');
const resultsDiv = document.getElementById('results');
const statusDiv = document.getElementById('status');

// Load JSON data
fetch('lexicon.json')
    .then(response => response.json())
    .then(data => {
        terms = Object.keys(data).map(id => ({
            id,
            en: Array.isArray(data[id].en_terms) ? data[id].en_terms : [],
            fi: Array.isArray(data[id].fi_terms) ? data[id].fi_terms : [],
            domains: data[id].domains || [],
            tags: data[id].tags || [],
            status: data[id].status || '',
            date: data[id].date || '',
            comments: data[id].comments || '',
            en_notes: data[id].en_notes || '',
            fi_notes: data[id].fi_notes || ''
        }));

        // Only keep ready items, safely
        .filter(t => typeof t.status === 'string' && t.status.toLowerCase() === 'ready');

        statusDiv.textContent = `Sanasto ladattu onnistuneesti, ${terms.length} termiä.`;
        searchInput.disabled = false;
    })
    .catch(err => {
        statusDiv.textContent = 'JSON-tiedoston lataus ei onnistunut.';
        console.error("JSON-tiedoston lataus ei onnistunut:", err);
    });

// Search function
searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    resultsDiv.innerHTML = '';

    if (!query) return;

    const filtered = terms.filter(t => 
        t.id.toLowerCase().includes(query) ||
        (Array.isArray(t.fi) && t.fi.some(f => f.toLowerCase().includes(query))) ||
        (Array.isArray(t.en) && t.en.some(e => e.toLowerCase().includes(query)))
    );

    if (filtered.length === 0) {
        resultsDiv.innerHTML = '<p>Ei osumia.</p>';
        return;
    }

    filtered.forEach(t => {
        const div = document.createElement('div');
        div.className = 'term';
        div.innerHTML = `
            <div class="concept-id">${t.id}</div>
            <span class="label">suomi:</span> ${t.fi.join(', ') || '-'}<br>
            <span class="label">englanti:</span> ${t.en.join(', ') || '-'}<br>
            ${t.comments ? `<span class="label">Kommentti:</span> ${t.comments}<br>` : ''}
            ${t.en_notes ? `<span class="label">English note:</span> ${t.en_notes}<br>` : ''}
            ${t.fi_notes ? `<span class="label">Suomi-note:</span> ${t.fi_notes}<br>` : ''}
        `;
        resultsDiv.appendChild(div);
    });
});
</script>

</body>
</html>
